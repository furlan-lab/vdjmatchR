---
title: "Database management and filtering"
author: "vdjmatchR Authors"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Database management and filtering}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", eval = FALSE)
```

This vignette covers using the packaged VDJdb, filtering it for common use cases, and how to point the package to your own database file.

## Packaged database and updates

```{r}
library(vdjmatchR)
# Use the slim VDJdb bundled with the package
path <- vdjdb_packaged_path(use_fat_db = FALSE)

# Optionally update to the latest slim/full VDJdb into the package's extdata
# path <- vdjdb_update_latest(use_fat_db = FALSE)

# Or use the full ("fat") VDJdb bundled with the package
# path <- vdjdb_packaged_path(use_fat_db = TRUE)
```

## Load and inspect

```{r}
db <- vdjdb_open_file(path)
vdjdb_len(db)
```

## Filter by species, gene, and VDJdb score

```{r}
# Human TRB, minimum VDJdb score 2
fdb <- filter_db(db, species = "HomoSapiens", gene = "TRB", min_vdjdb_score = 2)
```

## Filter by epitope size

```{r}
# Keep epitopes with at least 5 unique CDR3 entries
fdb2 <- filter_db_by_epitope_size(fdb, min_size = 5)
```

## Use your own database file

```{r, eval=FALSE}
# Tell vdjmatchR where your own VDJdb file is for this session
vdjdb_set_user_db("/path/to/vdjdb.txt.gz", use_fat_db = TRUE)
path <- vdjdb_path(use_fat_db = TRUE)
```

## Reproducibility hints

- Record the file path used (`vdjdb_path()`) and include it in your analysis metadata.
- Consider snapshotting the TSV file alongside your project for long-term
  reproducibility.
