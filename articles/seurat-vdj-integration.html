<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Seurat v5 + 10x VDJ v2 Integration • vdjmatchR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Seurat v5 + 10x VDJ v2 Integration">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vdjmatchR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>TCR Matching</h6></li>
    <li><a class="dropdown-item" href="../articles/batch-matching.html">Batch Matching</a></li>
    <li><a class="dropdown-item" href="../articles/scoring-and-scope.html">Scoring and Search Scope</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Database Tools</h6></li>
    <li><a class="dropdown-item" href="../articles/database-management.html">Database Management</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Integration</h6></li>
    <li><a class="dropdown-item" href="../articles/seurat-vdj-integration.html">Seurat + 10x VDJ Integration</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/furlan-lab/vdjmatchR"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Seurat v5 + 10x VDJ v2 Integration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/furlan-lab/vdjmatchR/blob/HEAD/vignettes/seurat-vdj-integration.Rmd" class="external-link"><code>vignettes/seurat-vdj-integration.Rmd</code></a></small>
      <div class="d-none name"><code>seurat-vdj-integration.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h3>
<ul>
<li>R (&gt;= 4.0)</li>
<li>Rust (&gt;= 1.70) - <a href="https://www.rust-lang.org/tools/install" class="external-link">Install Rust</a>
</li>
<li>R development tools (Rtools on Windows, Xcode Command Line Tools on
macOS)</li>
</ul>
</div>
<div class="section level3">
<h3 id="from-github-in-r">From Github in R<a class="anchor" aria-label="anchor" href="#from-github-in-r"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"furlan-lab/vdjmatchR"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using GitHub PAT from the git credential store.</span></span>
<span><span class="co">#&gt; Downloading GitHub repo furlan-lab/vdjmatchR@HEAD</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD build</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; * checking for file ‘/private/var/folders/63/z3dzfmg53g31179qxhwt5cq00000gn/T/Rtmpz0Rl2n/remotesffde5bf76aa7/furlan-lab-vdjmatchR-775729e/DESCRIPTION’ ... OK</span></span>
<span><span class="co">#&gt; * preparing ‘vdjmatchR’:</span></span>
<span><span class="co">#&gt; * checking DESCRIPTION meta-information ... OK</span></span>
<span><span class="co">#&gt; * cleaning src</span></span>
<span><span class="co">#&gt; * checking for LF line-endings in source and make files and shell scripts</span></span>
<span><span class="co">#&gt; * checking for empty or unneeded directories</span></span>
<span><span class="co">#&gt; Omitted ‘LazyData’ from DESCRIPTION</span></span>
<span><span class="co">#&gt; * building ‘vdjmatchR_0.0.0.9000.tar.gz’</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clone-and-install-from-source-in-shell">Clone and install (from source) in shell<a class="anchor" aria-label="anchor" href="#clone-and-install-from-source-in-shell"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/furlan-lab/vdjmatchR.git</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="bu">cd</span> vdjmatchR</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL .</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; fatal: destination path 'vdjmatchR' already exists and is not an empty directory.</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; * installing to library ‘/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library’</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; * installing *source* package ‘vdjmatchR’ ...</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; ** using staged installation</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; Using cargo 1.85.1 (d73d2caf9 2024-12-31)</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; Using rustc 1.85.1 (4eb161250 2025-03-15)</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; Building for CRAN.</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; Cleaning previous `src/Makevars`.</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; Warning message:</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; In system("R CMD config MACOSX_DEPLOYMENT_TARGET", intern = TRUE) :</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt;   running command 'R CMD config MACOSX_DEPLOYMENT_TARGET' had status 1</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; Writing `src/Makevars`.</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; `tools/config.R` has finished.</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; ** libs</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; using C compiler: ‘Apple clang version 17.0.0 (clang-1700.0.13.3)’</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; using SDK: ‘MacOSX15.4.sdk’</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; if [ -f ./rust/vendor.tar.xz ]; then \</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt;      tar xf rust/vendor.tar.xz &amp;&amp; \</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt;      mkdir -p /Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/.cargo &amp;&amp; \</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt;      cp rust/vendor-config.toml /Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/.cargo/config.toml; \</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt;  fi</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt; export CARGO_HOME=/Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/.cargo &amp;&amp; \</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt;  export PATH="/Applications/Positron.app/Contents/Resources/app/extensions/positron-python/python_files/deactivate/zsh:/Users/sfurlan/.pyenv/versions/3.9.22/bin:/Applications/Positron.app/Contents/Resources/app/quarto/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/opt/X11/bin:/Applications/Positron.app/Contents/Resources/app/quarto/bin:/Applications/Positron.app/Contents/Resources/app/extensions/positron-python/python_files/deactivate/zsh:/Users/sfurlan/.pyenv/versions/3.9.22/bin:/Users/sfurlan/micromamba/condabin:/Users/sfurlan/.pyenv/shims:/Users/sfurlan/.local/bin:/Users/sfurlan/.cargo/bin:/Users/sfurlan/.cargo/bin" &amp;&amp; \</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt;  export MACOSX_DEPLOYMENT_TARGET=15.0 &amp;&amp; \</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt;  RUSTFLAGS=" --print=native-static-libs" cargo build  --lib --release --manifest-path=./rust/Cargo.toml --target-dir ./rust/target </span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt;     Updating crates.io index</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt;  Downloading crates ...</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt;   Downloaded equivalent v1.0.2</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt;   Downloaded socket2 v0.5.10</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt;   Downloaded thiserror v1.0.69</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt;   Downloaded sync_wrapper v0.1.2</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt;   Downloaded option-ext v0.2.0</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt;   Downloaded either v1.15.0</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt;   Downloaded want v0.3.1</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt;   Downloaded adler2 v2.0.1</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt;   Downloaded tower-service v0.3.3</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;   Downloaded futures-io v0.3.31</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt;   Downloaded simd-adler32 v0.3.7</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt;   Downloaded try-lock v0.2.5</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt;   Downloaded http-body v0.4.6</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt;   Downloaded dirs v5.0.1</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt;   Downloaded system-configuration-sys v0.5.0</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt;   Downloaded zerofrom v0.1.6</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt;   Downloaded httpdate v1.0.3</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt;   Downloaded futures-task v0.3.31</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt;   Downloaded form_urlencoded v1.2.2</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt;   Downloaded lazy_static v1.5.0</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt;   Downloaded dirs-sys v0.4.1</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt;   Downloaded percent-encoding v2.3.2</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt;   Downloaded cfg-if v1.0.4</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt;   Downloaded extendr-macros v0.6.0</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt;   Downloaded errno v0.3.14</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt;   Downloaded fnv v1.0.7</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt;   Downloaded fastrand v2.3.0</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a><span class="co">#&gt;   Downloaded shlex v1.3.0</span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a><span class="co">#&gt;   Downloaded itoa v1.0.15</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="co">#&gt;   Downloaded hyper-tls v0.5.0</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co">#&gt;   Downloaded utf8_iter v1.0.4</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="co">#&gt;   Downloaded synstructure v0.13.2</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a><span class="co">#&gt;   Downloaded rustls-pemfile v1.0.4</span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co">#&gt;   Downloaded yoke-derive v0.8.1</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co">#&gt;   Downloaded mime v0.3.17</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a><span class="co">#&gt;   Downloaded paste v1.0.15</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="co">#&gt;   Downloaded system-configuration v0.5.1</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a><span class="co">#&gt;   Downloaded security-framework-sys v2.15.0</span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a><span class="co">#&gt;   Downloaded potential_utf v0.1.4</span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="co">#&gt;   Downloaded untrusted v0.9.0</span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a><span class="co">#&gt;   Downloaded crossbeam-deque v0.8.6</span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a><span class="co">#&gt;   Downloaded thiserror-impl v1.0.69</span></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a><span class="co">#&gt;   Downloaded writeable v0.6.2</span></span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a><span class="co">#&gt;   Downloaded unicode-ident v1.0.22</span></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a><span class="co">#&gt;   Downloaded slab v0.4.11</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a><span class="co">#&gt;   Downloaded serde_urlencoded v0.7.1</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a><span class="co">#&gt;   Downloaded pin-utils v0.1.0</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a><span class="co">#&gt;   Downloaded futures-sink v0.3.31</span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a><span class="co">#&gt;   Downloaded futures-core v0.3.31</span></span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a><span class="co">#&gt;   Downloaded zerovec-derive v0.11.2</span></span>
<span id="cb2-81"><a href="#cb2-81" tabindex="-1"></a><span class="co">#&gt;   Downloaded crc32fast v1.5.0</span></span>
<span id="cb2-82"><a href="#cb2-82" tabindex="-1"></a><span class="co">#&gt;   Downloaded bitflags v1.3.2</span></span>
<span id="cb2-83"><a href="#cb2-83" tabindex="-1"></a><span class="co">#&gt;   Downloaded stable_deref_trait v1.2.1</span></span>
<span id="cb2-84"><a href="#cb2-84" tabindex="-1"></a><span class="co">#&gt;   Downloaded futures-channel v0.3.31</span></span>
<span id="cb2-85"><a href="#cb2-85" tabindex="-1"></a><span class="co">#&gt;   Downloaded zerofrom-derive v0.1.6</span></span>
<span id="cb2-86"><a href="#cb2-86" tabindex="-1"></a><span class="co">#&gt;   Downloaded csv-core v0.1.13</span></span>
<span id="cb2-87"><a href="#cb2-87" tabindex="-1"></a><span class="co">#&gt;   Downloaded idna_adapter v1.2.1</span></span>
<span id="cb2-88"><a href="#cb2-88" tabindex="-1"></a><span class="co">#&gt;   Downloaded yoke v0.8.1</span></span>
<span id="cb2-89"><a href="#cb2-89" tabindex="-1"></a><span class="co">#&gt;   Downloaded ipnet v2.11.0</span></span>
<span id="cb2-90"><a href="#cb2-90" tabindex="-1"></a><span class="co">#&gt;   Downloaded core-foundation-sys v0.8.7</span></span>
<span id="cb2-91"><a href="#cb2-91" tabindex="-1"></a><span class="co">#&gt;   Downloaded displaydoc v0.2.5</span></span>
<span id="cb2-92"><a href="#cb2-92" tabindex="-1"></a><span class="co">#&gt;   Downloaded native-tls v0.2.14</span></span>
<span id="cb2-93"><a href="#cb2-93" tabindex="-1"></a><span class="co">#&gt;   Downloaded tokio-native-tls v0.3.1</span></span>
<span id="cb2-94"><a href="#cb2-94" tabindex="-1"></a><span class="co">#&gt;   Downloaded hyper-rustls v0.24.2</span></span>
<span id="cb2-95"><a href="#cb2-95" tabindex="-1"></a><span class="co">#&gt;   Downloaded sct v0.7.1</span></span>
<span id="cb2-96"><a href="#cb2-96" tabindex="-1"></a><span class="co">#&gt;   Downloaded core-foundation v0.9.4</span></span>
<span id="cb2-97"><a href="#cb2-97" tabindex="-1"></a><span class="co">#&gt;   Downloaded find-msvc-tools v0.1.5</span></span>
<span id="cb2-98"><a href="#cb2-98" tabindex="-1"></a><span class="co">#&gt;   Downloaded tinystr v0.8.2</span></span>
<span id="cb2-99"><a href="#cb2-99" tabindex="-1"></a><span class="co">#&gt;   Downloaded quote v1.0.42</span></span>
<span id="cb2-100"><a href="#cb2-100" tabindex="-1"></a><span class="co">#&gt;   Downloaded tokio-rustls v0.24.1</span></span>
<span id="cb2-101"><a href="#cb2-101" tabindex="-1"></a><span class="co">#&gt;   Downloaded litemap v0.8.1</span></span>
<span id="cb2-102"><a href="#cb2-102" tabindex="-1"></a><span class="co">#&gt;   Downloaded smallvec v1.15.1</span></span>
<span id="cb2-103"><a href="#cb2-103" tabindex="-1"></a><span class="co">#&gt;   Downloaded once_cell v1.21.3</span></span>
<span id="cb2-104"><a href="#cb2-104" tabindex="-1"></a><span class="co">#&gt;   Downloaded pin-project-lite v0.2.16</span></span>
<span id="cb2-105"><a href="#cb2-105" tabindex="-1"></a><span class="co">#&gt;   Downloaded getrandom v0.2.16</span></span>
<span id="cb2-106"><a href="#cb2-106" tabindex="-1"></a><span class="co">#&gt;   Downloaded crossbeam-utils v0.8.21</span></span>
<span id="cb2-107"><a href="#cb2-107" tabindex="-1"></a><span class="co">#&gt;   Downloaded log v0.4.28</span></span>
<span id="cb2-108"><a href="#cb2-108" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_provider v2.1.1</span></span>
<span id="cb2-109"><a href="#cb2-109" tabindex="-1"></a><span class="co">#&gt;   Downloaded crossbeam-epoch v0.9.18</span></span>
<span id="cb2-110"><a href="#cb2-110" tabindex="-1"></a><span class="co">#&gt;   Downloaded bitflags v2.10.0</span></span>
<span id="cb2-111"><a href="#cb2-111" tabindex="-1"></a><span class="co">#&gt;   Downloaded ryu v1.0.20</span></span>
<span id="cb2-112"><a href="#cb2-112" tabindex="-1"></a><span class="co">#&gt;   Downloaded tempfile v3.23.0</span></span>
<span id="cb2-113"><a href="#cb2-113" tabindex="-1"></a><span class="co">#&gt;   Downloaded zerotrie v0.2.3</span></span>
<span id="cb2-114"><a href="#cb2-114" tabindex="-1"></a><span class="co">#&gt;   Downloaded tracing-core v0.1.34</span></span>
<span id="cb2-115"><a href="#cb2-115" tabindex="-1"></a><span class="co">#&gt;   Downloaded getrandom v0.3.4</span></span>
<span id="cb2-116"><a href="#cb2-116" tabindex="-1"></a><span class="co">#&gt;   Downloaded serde_derive v1.0.228</span></span>
<span id="cb2-117"><a href="#cb2-117" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_properties v2.1.1</span></span>
<span id="cb2-118"><a href="#cb2-118" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_locale_core v2.1.1</span></span>
<span id="cb2-119"><a href="#cb2-119" tabindex="-1"></a><span class="co">#&gt;   Downloaded url v2.5.7</span></span>
<span id="cb2-120"><a href="#cb2-120" tabindex="-1"></a><span class="co">#&gt;   Downloaded httparse v1.10.1</span></span>
<span id="cb2-121"><a href="#cb2-121" tabindex="-1"></a><span class="co">#&gt;   Downloaded miniz_oxide v0.8.9</span></span>
<span id="cb2-122"><a href="#cb2-122" tabindex="-1"></a><span class="co">#&gt;   Downloaded tracing v0.1.41</span></span>
<span id="cb2-123"><a href="#cb2-123" tabindex="-1"></a><span class="co">#&gt;   Downloaded bytes v1.11.0</span></span>
<span id="cb2-124"><a href="#cb2-124" tabindex="-1"></a><span class="co">#&gt;   Downloaded serde_core v1.0.228</span></span>
<span id="cb2-125"><a href="#cb2-125" tabindex="-1"></a><span class="co">#&gt;   Downloaded rayon-core v1.13.0</span></span>
<span id="cb2-126"><a href="#cb2-126" tabindex="-1"></a><span class="co">#&gt;   Downloaded flate2 v1.1.5</span></span>
<span id="cb2-127"><a href="#cb2-127" tabindex="-1"></a><span class="co">#&gt;   Downloaded zerovec v0.11.5</span></span>
<span id="cb2-128"><a href="#cb2-128" tabindex="-1"></a><span class="co">#&gt;   Downloaded cc v1.2.46</span></span>
<span id="cb2-129"><a href="#cb2-129" tabindex="-1"></a><span class="co">#&gt;   Downloaded indexmap v2.12.0</span></span>
<span id="cb2-130"><a href="#cb2-130" tabindex="-1"></a><span class="co">#&gt;   Downloaded security-framework v2.11.1</span></span>
<span id="cb2-131"><a href="#cb2-131" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_collections v2.1.1</span></span>
<span id="cb2-132"><a href="#cb2-132" tabindex="-1"></a><span class="co">#&gt;   Downloaded tokio-util v0.7.17</span></span>
<span id="cb2-133"><a href="#cb2-133" tabindex="-1"></a><span class="co">#&gt;   Downloaded aho-corasick v1.1.4</span></span>
<span id="cb2-134"><a href="#cb2-134" tabindex="-1"></a><span class="co">#&gt;   Downloaded http v0.2.12</span></span>
<span id="cb2-135"><a href="#cb2-135" tabindex="-1"></a><span class="co">#&gt;   Downloaded mio v1.1.0</span></span>
<span id="cb2-136"><a href="#cb2-136" tabindex="-1"></a><span class="co">#&gt;   Downloaded memchr v2.7.6</span></span>
<span id="cb2-137"><a href="#cb2-137" tabindex="-1"></a><span class="co">#&gt;   Downloaded base64 v0.21.7</span></span>
<span id="cb2-138"><a href="#cb2-138" tabindex="-1"></a><span class="co">#&gt;   Downloaded serde v1.0.228</span></span>
<span id="cb2-139"><a href="#cb2-139" tabindex="-1"></a><span class="co">#&gt;   Downloaded hashbrown v0.16.0</span></span>
<span id="cb2-140"><a href="#cb2-140" tabindex="-1"></a><span class="co">#&gt;   Downloaded socket2 v0.6.1</span></span>
<span id="cb2-141"><a href="#cb2-141" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_normalizer_data v2.1.1</span></span>
<span id="cb2-142"><a href="#cb2-142" tabindex="-1"></a><span class="co">#&gt;   Downloaded proc-macro2 v1.0.103</span></span>
<span id="cb2-143"><a href="#cb2-143" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_normalizer v2.1.1</span></span>
<span id="cb2-144"><a href="#cb2-144" tabindex="-1"></a><span class="co">#&gt;   Downloaded reqwest v0.11.27</span></span>
<span id="cb2-145"><a href="#cb2-145" tabindex="-1"></a><span class="co">#&gt;   Downloaded webpki-roots v0.25.4</span></span>
<span id="cb2-146"><a href="#cb2-146" tabindex="-1"></a><span class="co">#&gt;   Downloaded extendr-api v0.6.0</span></span>
<span id="cb2-147"><a href="#cb2-147" tabindex="-1"></a><span class="co">#&gt;   Downloaded rustls-webpki v0.101.7</span></span>
<span id="cb2-148"><a href="#cb2-148" tabindex="-1"></a><span class="co">#&gt;   Downloaded idna v1.1.0</span></span>
<span id="cb2-149"><a href="#cb2-149" tabindex="-1"></a><span class="co">#&gt;   Downloaded syn v2.0.110</span></span>
<span id="cb2-150"><a href="#cb2-150" tabindex="-1"></a><span class="co">#&gt;   Downloaded hyper v0.14.32</span></span>
<span id="cb2-151"><a href="#cb2-151" tabindex="-1"></a><span class="co">#&gt;   Downloaded regex v1.12.2</span></span>
<span id="cb2-152"><a href="#cb2-152" tabindex="-1"></a><span class="co">#&gt;   Downloaded rayon v1.11.0</span></span>
<span id="cb2-153"><a href="#cb2-153" tabindex="-1"></a><span class="co">#&gt;   Downloaded rustls v0.21.12</span></span>
<span id="cb2-154"><a href="#cb2-154" tabindex="-1"></a><span class="co">#&gt;   Downloaded icu_properties_data v2.1.1</span></span>
<span id="cb2-155"><a href="#cb2-155" tabindex="-1"></a><span class="co">#&gt;   Downloaded h2 v0.3.27</span></span>
<span id="cb2-156"><a href="#cb2-156" tabindex="-1"></a><span class="co">#&gt;   Downloaded futures-util v0.3.31</span></span>
<span id="cb2-157"><a href="#cb2-157" tabindex="-1"></a><span class="co">#&gt;   Downloaded regex-syntax v0.8.8</span></span>
<span id="cb2-158"><a href="#cb2-158" tabindex="-1"></a><span class="co">#&gt;   Downloaded rustix v1.1.2</span></span>
<span id="cb2-159"><a href="#cb2-159" tabindex="-1"></a><span class="co">#&gt;   Downloaded libR-sys v0.6.0</span></span>
<span id="cb2-160"><a href="#cb2-160" tabindex="-1"></a><span class="co">#&gt;   Downloaded tokio v1.48.0</span></span>
<span id="cb2-161"><a href="#cb2-161" tabindex="-1"></a><span class="co">#&gt;   Downloaded regex-automata v0.4.13</span></span>
<span id="cb2-162"><a href="#cb2-162" tabindex="-1"></a><span class="co">#&gt;   Downloaded libc v0.2.177</span></span>
<span id="cb2-163"><a href="#cb2-163" tabindex="-1"></a><span class="co">#&gt;   Downloaded csv v1.4.0</span></span>
<span id="cb2-164"><a href="#cb2-164" tabindex="-1"></a><span class="co">#&gt;   Downloaded encoding_rs v0.8.35</span></span>
<span id="cb2-165"><a href="#cb2-165" tabindex="-1"></a><span class="co">#&gt;   Downloaded ring v0.17.14</span></span>
<span id="cb2-166"><a href="#cb2-166" tabindex="-1"></a><span class="co">#&gt;    Compiling libc v0.2.177</span></span>
<span id="cb2-167"><a href="#cb2-167" tabindex="-1"></a><span class="co">#&gt;    Compiling proc-macro2 v1.0.103</span></span>
<span id="cb2-168"><a href="#cb2-168" tabindex="-1"></a><span class="co">#&gt;    Compiling quote v1.0.42</span></span>
<span id="cb2-169"><a href="#cb2-169" tabindex="-1"></a><span class="co">#&gt;    Compiling unicode-ident v1.0.22</span></span>
<span id="cb2-170"><a href="#cb2-170" tabindex="-1"></a><span class="co">#&gt;    Compiling cfg-if v1.0.4</span></span>
<span id="cb2-171"><a href="#cb2-171" tabindex="-1"></a><span class="co">#&gt;    Compiling stable_deref_trait v1.2.1</span></span>
<span id="cb2-172"><a href="#cb2-172" tabindex="-1"></a><span class="co">#&gt;    Compiling pin-project-lite v0.2.16</span></span>
<span id="cb2-173"><a href="#cb2-173" tabindex="-1"></a><span class="co">#&gt;    Compiling once_cell v1.21.3</span></span>
<span id="cb2-174"><a href="#cb2-174" tabindex="-1"></a><span class="co">#&gt;    Compiling shlex v1.3.0</span></span>
<span id="cb2-175"><a href="#cb2-175" tabindex="-1"></a><span class="co">#&gt;    Compiling bytes v1.11.0</span></span>
<span id="cb2-176"><a href="#cb2-176" tabindex="-1"></a><span class="co">#&gt;    Compiling find-msvc-tools v0.1.5</span></span>
<span id="cb2-177"><a href="#cb2-177" tabindex="-1"></a><span class="co">#&gt;    Compiling memchr v2.7.6</span></span>
<span id="cb2-178"><a href="#cb2-178" tabindex="-1"></a><span class="co">#&gt;    Compiling itoa v1.0.15</span></span>
<span id="cb2-179"><a href="#cb2-179" tabindex="-1"></a><span class="co">#&gt;    Compiling core-foundation-sys v0.8.7</span></span>
<span id="cb2-180"><a href="#cb2-180" tabindex="-1"></a><span class="co">#&gt;    Compiling writeable v0.6.2</span></span>
<span id="cb2-181"><a href="#cb2-181" tabindex="-1"></a><span class="co">#&gt;    Compiling litemap v0.8.1</span></span>
<span id="cb2-182"><a href="#cb2-182" tabindex="-1"></a><span class="co">#&gt;    Compiling futures-core v0.3.31</span></span>
<span id="cb2-183"><a href="#cb2-183" tabindex="-1"></a><span class="co">#&gt;    Compiling bitflags v2.10.0</span></span>
<span id="cb2-184"><a href="#cb2-184" tabindex="-1"></a><span class="co">#&gt;    Compiling getrandom v0.3.4</span></span>
<span id="cb2-185"><a href="#cb2-185" tabindex="-1"></a><span class="co">#&gt;    Compiling serde_core v1.0.228</span></span>
<span id="cb2-186"><a href="#cb2-186" tabindex="-1"></a><span class="co">#&gt;    Compiling untrusted v0.9.0</span></span>
<span id="cb2-187"><a href="#cb2-187" tabindex="-1"></a><span class="co">#&gt;    Compiling rustix v1.1.2</span></span>
<span id="cb2-188"><a href="#cb2-188" tabindex="-1"></a><span class="co">#&gt;    Compiling cc v1.2.46</span></span>
<span id="cb2-189"><a href="#cb2-189" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_properties_data v2.1.1</span></span>
<span id="cb2-190"><a href="#cb2-190" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_normalizer_data v2.1.1</span></span>
<span id="cb2-191"><a href="#cb2-191" tabindex="-1"></a><span class="co">#&gt;    Compiling fnv v1.0.7</span></span>
<span id="cb2-192"><a href="#cb2-192" tabindex="-1"></a><span class="co">#&gt;    Compiling tracing-core v0.1.34</span></span>
<span id="cb2-193"><a href="#cb2-193" tabindex="-1"></a><span class="co">#&gt;    Compiling futures-task v0.3.31</span></span>
<span id="cb2-194"><a href="#cb2-194" tabindex="-1"></a><span class="co">#&gt;    Compiling futures-io v0.3.31</span></span>
<span id="cb2-195"><a href="#cb2-195" tabindex="-1"></a><span class="co">#&gt;    Compiling hashbrown v0.16.0</span></span>
<span id="cb2-196"><a href="#cb2-196" tabindex="-1"></a><span class="co">#&gt;    Compiling crossbeam-utils v0.8.21</span></span>
<span id="cb2-197"><a href="#cb2-197" tabindex="-1"></a><span class="co">#&gt;    Compiling httparse v1.10.1</span></span>
<span id="cb2-198"><a href="#cb2-198" tabindex="-1"></a><span class="co">#&gt;    Compiling pin-utils v0.1.0</span></span>
<span id="cb2-199"><a href="#cb2-199" tabindex="-1"></a><span class="co">#&gt;    Compiling equivalent v1.0.2</span></span>
<span id="cb2-200"><a href="#cb2-200" tabindex="-1"></a><span class="co">#&gt;    Compiling http v0.2.12</span></span>
<span id="cb2-201"><a href="#cb2-201" tabindex="-1"></a><span class="co">#&gt;    Compiling futures-sink v0.3.31</span></span>
<span id="cb2-202"><a href="#cb2-202" tabindex="-1"></a><span class="co">#&gt;    Compiling slab v0.4.11</span></span>
<span id="cb2-203"><a href="#cb2-203" tabindex="-1"></a><span class="co">#&gt;    Compiling tracing v0.1.41</span></span>
<span id="cb2-204"><a href="#cb2-204" tabindex="-1"></a><span class="co">#&gt;    Compiling futures-util v0.3.31</span></span>
<span id="cb2-205"><a href="#cb2-205" tabindex="-1"></a><span class="co">#&gt;    Compiling indexmap v2.12.0</span></span>
<span id="cb2-206"><a href="#cb2-206" tabindex="-1"></a><span class="co">#&gt;    Compiling rustls v0.21.12</span></span>
<span id="cb2-207"><a href="#cb2-207" tabindex="-1"></a><span class="co">#&gt;    Compiling native-tls v0.2.14</span></span>
<span id="cb2-208"><a href="#cb2-208" tabindex="-1"></a><span class="co">#&gt;    Compiling smallvec v1.15.1</span></span>
<span id="cb2-209"><a href="#cb2-209" tabindex="-1"></a><span class="co">#&gt;    Compiling serde v1.0.228</span></span>
<span id="cb2-210"><a href="#cb2-210" tabindex="-1"></a><span class="co">#&gt;    Compiling try-lock v0.2.5</span></span>
<span id="cb2-211"><a href="#cb2-211" tabindex="-1"></a><span class="co">#&gt;    Compiling fastrand v2.3.0</span></span>
<span id="cb2-212"><a href="#cb2-212" tabindex="-1"></a><span class="co">#&gt;    Compiling want v0.3.1</span></span>
<span id="cb2-213"><a href="#cb2-213" tabindex="-1"></a><span class="co">#&gt;    Compiling ring v0.17.14</span></span>
<span id="cb2-214"><a href="#cb2-214" tabindex="-1"></a><span class="co">#&gt;    Compiling syn v2.0.110</span></span>
<span id="cb2-215"><a href="#cb2-215" tabindex="-1"></a><span class="co">#&gt;    Compiling http-body v0.4.6</span></span>
<span id="cb2-216"><a href="#cb2-216" tabindex="-1"></a><span class="co">#&gt;    Compiling socket2 v0.6.1</span></span>
<span id="cb2-217"><a href="#cb2-217" tabindex="-1"></a><span class="co">#&gt;    Compiling mio v1.1.0</span></span>
<span id="cb2-218"><a href="#cb2-218" tabindex="-1"></a><span class="co">#&gt;    Compiling getrandom v0.2.16</span></span>
<span id="cb2-219"><a href="#cb2-219" tabindex="-1"></a><span class="co">#&gt;    Compiling core-foundation v0.9.4</span></span>
<span id="cb2-220"><a href="#cb2-220" tabindex="-1"></a><span class="co">#&gt;    Compiling errno v0.3.14</span></span>
<span id="cb2-221"><a href="#cb2-221" tabindex="-1"></a><span class="co">#&gt;    Compiling security-framework-sys v2.15.0</span></span>
<span id="cb2-222"><a href="#cb2-222" tabindex="-1"></a><span class="co">#&gt;    Compiling socket2 v0.5.10</span></span>
<span id="cb2-223"><a href="#cb2-223" tabindex="-1"></a><span class="co">#&gt;    Compiling security-framework v2.11.1</span></span>
<span id="cb2-224"><a href="#cb2-224" tabindex="-1"></a><span class="co">#&gt;    Compiling tokio v1.48.0</span></span>
<span id="cb2-225"><a href="#cb2-225" tabindex="-1"></a><span class="co">#&gt;    Compiling futures-channel v0.3.31</span></span>
<span id="cb2-226"><a href="#cb2-226" tabindex="-1"></a><span class="co">#&gt;    Compiling log v0.4.28</span></span>
<span id="cb2-227"><a href="#cb2-227" tabindex="-1"></a><span class="co">#&gt;    Compiling libR-sys v0.6.0</span></span>
<span id="cb2-228"><a href="#cb2-228" tabindex="-1"></a><span class="co">#&gt;    Compiling tower-service v0.3.3</span></span>
<span id="cb2-229"><a href="#cb2-229" tabindex="-1"></a><span class="co">#&gt;    Compiling percent-encoding v2.3.2</span></span>
<span id="cb2-230"><a href="#cb2-230" tabindex="-1"></a><span class="co">#&gt;    Compiling system-configuration-sys v0.5.0</span></span>
<span id="cb2-231"><a href="#cb2-231" tabindex="-1"></a><span class="co">#&gt;    Compiling httpdate v1.0.3</span></span>
<span id="cb2-232"><a href="#cb2-232" tabindex="-1"></a><span class="co">#&gt;    Compiling form_urlencoded v1.2.2</span></span>
<span id="cb2-233"><a href="#cb2-233" tabindex="-1"></a><span class="co">#&gt;    Compiling paste v1.0.15</span></span>
<span id="cb2-234"><a href="#cb2-234" tabindex="-1"></a><span class="co">#&gt;    Compiling utf8_iter v1.0.4</span></span>
<span id="cb2-235"><a href="#cb2-235" tabindex="-1"></a><span class="co">#&gt;    Compiling rayon-core v1.13.0</span></span>
<span id="cb2-236"><a href="#cb2-236" tabindex="-1"></a><span class="co">#&gt;    Compiling ryu v1.0.20</span></span>
<span id="cb2-237"><a href="#cb2-237" tabindex="-1"></a><span class="co">#&gt;    Compiling crc32fast v1.5.0</span></span>
<span id="cb2-238"><a href="#cb2-238" tabindex="-1"></a><span class="co">#&gt;    Compiling crossbeam-epoch v0.9.18</span></span>
<span id="cb2-239"><a href="#cb2-239" tabindex="-1"></a><span class="co">#&gt;    Compiling aho-corasick v1.1.4</span></span>
<span id="cb2-240"><a href="#cb2-240" tabindex="-1"></a><span class="co">#&gt;    Compiling bitflags v1.3.2</span></span>
<span id="cb2-241"><a href="#cb2-241" tabindex="-1"></a><span class="co">#&gt;    Compiling tempfile v3.23.0</span></span>
<span id="cb2-242"><a href="#cb2-242" tabindex="-1"></a><span class="co">#&gt;    Compiling crossbeam-deque v0.8.6</span></span>
<span id="cb2-243"><a href="#cb2-243" tabindex="-1"></a><span class="co">#&gt;    Compiling regex-syntax v0.8.8</span></span>
<span id="cb2-244"><a href="#cb2-244" tabindex="-1"></a><span class="co">#&gt;    Compiling simd-adler32 v0.3.7</span></span>
<span id="cb2-245"><a href="#cb2-245" tabindex="-1"></a><span class="co">#&gt;    Compiling option-ext v0.2.0</span></span>
<span id="cb2-246"><a href="#cb2-246" tabindex="-1"></a><span class="co">#&gt;    Compiling extendr-api v0.6.0</span></span>
<span id="cb2-247"><a href="#cb2-247" tabindex="-1"></a><span class="co">#&gt;    Compiling adler2 v2.0.1</span></span>
<span id="cb2-248"><a href="#cb2-248" tabindex="-1"></a><span class="co">#&gt;    Compiling thiserror v1.0.69</span></span>
<span id="cb2-249"><a href="#cb2-249" tabindex="-1"></a><span class="co">#&gt;    Compiling base64 v0.21.7</span></span>
<span id="cb2-250"><a href="#cb2-250" tabindex="-1"></a><span class="co">#&gt;    Compiling miniz_oxide v0.8.9</span></span>
<span id="cb2-251"><a href="#cb2-251" tabindex="-1"></a><span class="co">#&gt;    Compiling synstructure v0.13.2</span></span>
<span id="cb2-252"><a href="#cb2-252" tabindex="-1"></a><span class="co">#&gt;    Compiling rustls-pemfile v1.0.4</span></span>
<span id="cb2-253"><a href="#cb2-253" tabindex="-1"></a><span class="co">#&gt;    Compiling dirs-sys v0.4.1</span></span>
<span id="cb2-254"><a href="#cb2-254" tabindex="-1"></a><span class="co">#&gt;    Compiling system-configuration v0.5.1</span></span>
<span id="cb2-255"><a href="#cb2-255" tabindex="-1"></a><span class="co">#&gt;    Compiling csv-core v0.1.13</span></span>
<span id="cb2-256"><a href="#cb2-256" tabindex="-1"></a><span class="co">#&gt;    Compiling encoding_rs v0.8.35</span></span>
<span id="cb2-257"><a href="#cb2-257" tabindex="-1"></a><span class="co">#&gt;    Compiling sync_wrapper v0.1.2</span></span>
<span id="cb2-258"><a href="#cb2-258" tabindex="-1"></a><span class="co">#&gt;    Compiling either v1.15.0</span></span>
<span id="cb2-259"><a href="#cb2-259" tabindex="-1"></a><span class="co">#&gt;    Compiling webpki-roots v0.25.4</span></span>
<span id="cb2-260"><a href="#cb2-260" tabindex="-1"></a><span class="co">#&gt;    Compiling ipnet v2.11.0</span></span>
<span id="cb2-261"><a href="#cb2-261" tabindex="-1"></a><span class="co">#&gt;    Compiling mime v0.3.17</span></span>
<span id="cb2-262"><a href="#cb2-262" tabindex="-1"></a><span class="co">#&gt;    Compiling rayon v1.11.0</span></span>
<span id="cb2-263"><a href="#cb2-263" tabindex="-1"></a><span class="co">#&gt;    Compiling csv v1.4.0</span></span>
<span id="cb2-264"><a href="#cb2-264" tabindex="-1"></a><span class="co">#&gt;    Compiling dirs v5.0.1</span></span>
<span id="cb2-265"><a href="#cb2-265" tabindex="-1"></a><span class="co">#&gt;    Compiling flate2 v1.1.5</span></span>
<span id="cb2-266"><a href="#cb2-266" tabindex="-1"></a><span class="co">#&gt;    Compiling tokio-util v0.7.17</span></span>
<span id="cb2-267"><a href="#cb2-267" tabindex="-1"></a><span class="co">#&gt;    Compiling tokio-native-tls v0.3.1</span></span>
<span id="cb2-268"><a href="#cb2-268" tabindex="-1"></a><span class="co">#&gt;    Compiling lazy_static v1.5.0</span></span>
<span id="cb2-269"><a href="#cb2-269" tabindex="-1"></a><span class="co">#&gt;    Compiling regex-automata v0.4.13</span></span>
<span id="cb2-270"><a href="#cb2-270" tabindex="-1"></a><span class="co">#&gt;    Compiling h2 v0.3.27</span></span>
<span id="cb2-271"><a href="#cb2-271" tabindex="-1"></a><span class="co">#&gt;    Compiling zerofrom-derive v0.1.6</span></span>
<span id="cb2-272"><a href="#cb2-272" tabindex="-1"></a><span class="co">#&gt;    Compiling yoke-derive v0.8.1</span></span>
<span id="cb2-273"><a href="#cb2-273" tabindex="-1"></a><span class="co">#&gt;    Compiling zerovec-derive v0.11.2</span></span>
<span id="cb2-274"><a href="#cb2-274" tabindex="-1"></a><span class="co">#&gt;    Compiling displaydoc v0.2.5</span></span>
<span id="cb2-275"><a href="#cb2-275" tabindex="-1"></a><span class="co">#&gt;    Compiling serde_derive v1.0.228</span></span>
<span id="cb2-276"><a href="#cb2-276" tabindex="-1"></a><span class="co">#&gt;    Compiling thiserror-impl v1.0.69</span></span>
<span id="cb2-277"><a href="#cb2-277" tabindex="-1"></a><span class="co">#&gt;    Compiling extendr-macros v0.6.0</span></span>
<span id="cb2-278"><a href="#cb2-278" tabindex="-1"></a><span class="co">#&gt;    Compiling zerofrom v0.1.6</span></span>
<span id="cb2-279"><a href="#cb2-279" tabindex="-1"></a><span class="co">#&gt;    Compiling yoke v0.8.1</span></span>
<span id="cb2-280"><a href="#cb2-280" tabindex="-1"></a><span class="co">#&gt;    Compiling regex v1.12.2</span></span>
<span id="cb2-281"><a href="#cb2-281" tabindex="-1"></a><span class="co">#&gt;    Compiling zerovec v0.11.5</span></span>
<span id="cb2-282"><a href="#cb2-282" tabindex="-1"></a><span class="co">#&gt;    Compiling zerotrie v0.2.3</span></span>
<span id="cb2-283"><a href="#cb2-283" tabindex="-1"></a><span class="co">#&gt;    Compiling hyper v0.14.32</span></span>
<span id="cb2-284"><a href="#cb2-284" tabindex="-1"></a><span class="co">#&gt;    Compiling tinystr v0.8.2</span></span>
<span id="cb2-285"><a href="#cb2-285" tabindex="-1"></a><span class="co">#&gt;    Compiling potential_utf v0.1.4</span></span>
<span id="cb2-286"><a href="#cb2-286" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_collections v2.1.1</span></span>
<span id="cb2-287"><a href="#cb2-287" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_locale_core v2.1.1</span></span>
<span id="cb2-288"><a href="#cb2-288" tabindex="-1"></a><span class="co">#&gt;    Compiling serde_urlencoded v0.7.1</span></span>
<span id="cb2-289"><a href="#cb2-289" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_provider v2.1.1</span></span>
<span id="cb2-290"><a href="#cb2-290" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_normalizer v2.1.1</span></span>
<span id="cb2-291"><a href="#cb2-291" tabindex="-1"></a><span class="co">#&gt;    Compiling icu_properties v2.1.1</span></span>
<span id="cb2-292"><a href="#cb2-292" tabindex="-1"></a><span class="co">#&gt;    Compiling sct v0.7.1</span></span>
<span id="cb2-293"><a href="#cb2-293" tabindex="-1"></a><span class="co">#&gt;    Compiling rustls-webpki v0.101.7</span></span>
<span id="cb2-294"><a href="#cb2-294" tabindex="-1"></a><span class="co">#&gt;    Compiling idna_adapter v1.2.1</span></span>
<span id="cb2-295"><a href="#cb2-295" tabindex="-1"></a><span class="co">#&gt;    Compiling idna v1.1.0</span></span>
<span id="cb2-296"><a href="#cb2-296" tabindex="-1"></a><span class="co">#&gt;    Compiling hyper-tls v0.5.0</span></span>
<span id="cb2-297"><a href="#cb2-297" tabindex="-1"></a><span class="co">#&gt;    Compiling url v2.5.7</span></span>
<span id="cb2-298"><a href="#cb2-298" tabindex="-1"></a><span class="co">#&gt;    Compiling tokio-rustls v0.24.1</span></span>
<span id="cb2-299"><a href="#cb2-299" tabindex="-1"></a><span class="co">#&gt;    Compiling hyper-rustls v0.24.2</span></span>
<span id="cb2-300"><a href="#cb2-300" tabindex="-1"></a><span class="co">#&gt;    Compiling reqwest v0.11.27</span></span>
<span id="cb2-301"><a href="#cb2-301" tabindex="-1"></a><span class="co">#&gt;    Compiling vdjmatchR v0.0.1 (/Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/rust)</span></span>
<span id="cb2-302"><a href="#cb2-302" tabindex="-1"></a><span class="co">#&gt; note: Link against the following native artifacts when linking against this static library. The order and any duplication can be significant on some platforms.</span></span>
<span id="cb2-303"><a href="#cb2-303" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-304"><a href="#cb2-304" tabindex="-1"></a><span class="co">#&gt; note: native-static-libs: -framework SystemConfiguration -framework Security -framework CoreFoundation -liconv -lR -lSystem -lc -lm</span></span>
<span id="cb2-305"><a href="#cb2-305" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-306"><a href="#cb2-306" tabindex="-1"></a><span class="co">#&gt;     Finished `release` profile [optimized] target(s) in 11.20s</span></span>
<span id="cb2-307"><a href="#cb2-307" tabindex="-1"></a><span class="co">#&gt; # Always clean up CARGOTMP</span></span>
<span id="cb2-308"><a href="#cb2-308" tabindex="-1"></a><span class="co">#&gt; rm -Rf /Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/.cargo;</span></span>
<span id="cb2-309"><a href="#cb2-309" tabindex="-1"></a><span class="co">#&gt; clang -arch arm64 -dynamiclib -Wl,-headerpad_max_install_names -undefined dynamic_lookup -L/Library/Frameworks/R.framework/Resources/lib -L/opt/R/arm64/lib -o vdjmatchR.so entrypoint.o -L./rust/target/release -lvdjmatchR -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework -Wl,CoreFoundation</span></span>
<span id="cb2-310"><a href="#cb2-310" tabindex="-1"></a><span class="co">#&gt; rm -Rf /Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/.cargo /Users/sfurlan/develop/vdjmatchR/vignettes/vdjmatchR/src/vendor ./rust/target</span></span>
<span id="cb2-311"><a href="#cb2-311" tabindex="-1"></a><span class="co">#&gt; installing to /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/00LOCK-vdjmatchR/00new/vdjmatchR/libs</span></span>
<span id="cb2-312"><a href="#cb2-312" tabindex="-1"></a><span class="co">#&gt; ** R</span></span>
<span id="cb2-313"><a href="#cb2-313" tabindex="-1"></a><span class="co">#&gt; ** inst</span></span>
<span id="cb2-314"><a href="#cb2-314" tabindex="-1"></a><span class="co">#&gt; ** byte-compile and prepare package for lazy loading</span></span>
<span id="cb2-315"><a href="#cb2-315" tabindex="-1"></a><span class="co">#&gt; ** help</span></span>
<span id="cb2-316"><a href="#cb2-316" tabindex="-1"></a><span class="co">#&gt; *** installing help indices</span></span>
<span id="cb2-317"><a href="#cb2-317" tabindex="-1"></a><span class="co">#&gt; *** copying figures</span></span>
<span id="cb2-318"><a href="#cb2-318" tabindex="-1"></a><span class="co">#&gt; ** building package indices</span></span>
<span id="cb2-319"><a href="#cb2-319" tabindex="-1"></a><span class="co">#&gt; ** installing vignettes</span></span>
<span id="cb2-320"><a href="#cb2-320" tabindex="-1"></a><span class="co">#&gt; ** testing if installed package can be loaded from temporary location</span></span>
<span id="cb2-321"><a href="#cb2-321" tabindex="-1"></a><span class="co">#&gt; ** checking absolute paths in shared objects and dynamic libraries</span></span>
<span id="cb2-322"><a href="#cb2-322" tabindex="-1"></a><span class="co">#&gt; ** testing if installed package can be loaded from final location</span></span>
<span id="cb2-323"><a href="#cb2-323" tabindex="-1"></a><span class="co">#&gt; ** testing if installed package keeps a record of temporary installation path</span></span>
<span id="cb2-324"><a href="#cb2-324" tabindex="-1"></a><span class="co">#&gt; * DONE (vdjmatchR)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette shows how to: - Start from a Seurat v5 object. - Attach
10x 5’ VDJ v2 outputs to the object with flexible cell-name mapping. -
Inspect mapping diagnostics and basic metadata written by vdjmatchR.</p>
<p>Later sections (placeholders) will add pairing/QC, clonotype
definitions, and vdjmatchR matching.</p>
<p>Note: paths below reference user-specific data; code chunks are
guarded to run only if files exist.</p>
</div>
<div class="section level2">
<h2 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span>       <span class="co"># v5</span></span>
<span><span class="co">#&gt; Loading required package: SeuratObject</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; 'SeuratObject' was built under R 4.4.1 but the current version is</span></span>
<span><span class="co">#&gt; 4.4.3; it is recomended that you reinstall 'SeuratObject' as the ABI</span></span>
<span><span class="co">#&gt; for R may have changed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'SeuratObject'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, t</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://furlan-lab.github.io/vdjmatchR">vdjmatchR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="provide-your-inputs">Provide your inputs<a class="anchor" aria-label="anchor" href="#provide-your-inputs"></a>
</h2>
<p>Set the path to a Seurat v5 object (RDS) and to the 10x VDJ directory
(<code>vdj_t</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Edit these to your environment</span></span>
<span><span class="va">seurat_rds</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/furlan_s/user/jperalta/MMCarT_240212_reseq/cds/mmcart_seu_viewmastR_CARpositive_251023.RDS"</span></span>
<span><span class="co">#/Volumes/furlan_s/user/jperalta/MMCarT_240212_reseq/cds/mmcart_seu_viewmastR_CARpositive_251023.RDS</span></span>
<span><span class="co"># Example 10x VDJ v2 directory (replace as needed)</span></span>
<span><span class="va">vdj_dir</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/furlan_s/user/jperalta/MMCarT_240212_reseq/FOLDERNAME1/data/FOLDERNAME2/outs/per_sample_outs/FOLDERNAME2/vdj_t"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-seurat-object">Load Seurat object<a class="anchor" aria-label="anchor" href="#load-seurat-object"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="va">seurat_rds</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">seurat_rds</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">seurat_rds</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Set SEURAT_RDS_PATH to a Seurat v5 RDS file to run this vignette end-to-end."</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">prefixes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"[ACGT]{16}-\\d+$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Cells.html" class="external-link">Cells</a></span><span class="op">(</span><span class="va">orig</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">folders2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^[^_]+_(.+)_$"</span>, <span class="st">"\\1"</span>, <span class="va">prefixes</span><span class="op">)</span></span>
<span><span class="va">folders1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"_[^_]+$"</span>, <span class="st">""</span>, <span class="va">folders2</span><span class="op">)</span></span>
<span><span class="va">matchdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>PREFIXES<span class="op">=</span><span class="va">prefixes</span>, FOLDERNAME1<span class="op">=</span><span class="va">folders1</span>, FOLDERNAME2<span class="op">=</span><span class="va">folders2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="attach-10x-vdj-v2-to-seurat">Attach 10x VDJ v2 to Seurat<a class="anchor" aria-label="anchor" href="#attach-10x-vdj-v2-to-seurat"></a>
</h2>
<p>The function <code><a href="../reference/vdj_attach_10x_vdj_v2.html">vdj_attach_10x_vdj_v2()</a></code> reads
<code>filtered_contig_annotations.csv</code> and
<code>clonotypes.csv</code>, maps 10x barcodes to Seurat cell names
(with flexible strategies), and stores heavy tables in
<code>obj@tools$vdj</code>. Minimal metadata (10x clonotype id/size) can
be written per cell.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vdj_attach_10x_vdj_v2_batch.html">vdj_attach_10x_vdj_v2_batch</a></span><span class="op">(</span></span>
<span>  <span class="va">orig</span>,</span>
<span>  <span class="va">matchdf</span>,</span>
<span>  vdj_dir_template <span class="op">=</span> <span class="va">vdj_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="va">vdj.cdr3_aa_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">vdj.tra.cdr3_aa</span>, <span class="st">"_"</span>, <span class="va">obj</span><span class="op">$</span><span class="va">vdj.trb.cdr3_aa</span><span class="op">)</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="va">nomatchprior</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">vdj.cdr3_aa_both</span> <span class="op">!=</span> <span class="va">obj</span><span class="op">$</span><span class="va">cdr3</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">nomatchprior</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">nomatchprior</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">nomatchprior</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">obj</span>, group.by <span class="op">=</span> <span class="st">"nomatchprior"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="collapse-to-tra1trb-dominant-and-optional-tra2trb-secondary">Collapse to TRA1/TRB (dominant) and optional TRA2/TRB
(secondary)<a class="anchor" aria-label="anchor" href="#collapse-to-tra1trb-dominant-and-optional-tra2trb-secondary"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Select 1 TRB and up to 2 TRA per cell; write metadata and a pairs table</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vdj_collapse_pairs_seurat.html">vdj_collapse_pairs_seurat</a></span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  drop_multi_trb <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  keep_two_alpha <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alpha_support <span class="op">=</span> <span class="st">"umis"</span>,</span>
<span>  require_productive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  write_meta <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  update_primary_meta <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overall dual-TRA fraction</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"vdj.has_tra2"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">frac_dual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">vdj.has_tra2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Dual-TRA fraction: %.1f%%\n"</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">frac_dual</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Per-cluster dual-TRA rates when cluster labels exist</span></span>
<span><span class="va">group_col</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"seurat_clusters"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">)</span> <span class="va">group_col</span> <span class="op">&lt;-</span> <span class="st">"seurat_clusters"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">group_col</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">meta.data</span><span class="op">[[</span><span class="va">group_col</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">vdj.has_tra2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="cn">TRUE</span>, <span class="va">g</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">p</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Preview pairs table (first 6 rows)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">tools</span><span class="op">$</span><span class="va">vdj</span><span class="op">$</span><span class="va">pairs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">tools</span><span class="op">$</span><span class="va">vdj</span><span class="op">$</span><span class="va">pairs</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspect-attached-tables-and-metadata">Inspect attached tables and metadata<a class="anchor" aria-label="anchor" href="#inspect-attached-tables-and-metadata"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Contigs rows:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">tools</span><span class="op">$</span><span class="va">vdj</span><span class="op">$</span><span class="va">contigs</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">tools</span><span class="op">$</span><span class="va">vdj</span><span class="op">$</span><span class="va">contigs</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"barcode"</span>,<span class="st">"chain"</span>,<span class="st">"v_gene"</span>,<span class="st">"j_gene"</span>,<span class="st">"cdr3"</span>,<span class="st">"umis"</span>,<span class="st">"cell"</span>,<span class="st">"sample_id"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vdj.clone_id_10x"</span>,<span class="st">"vdj.clone_size_10x"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">meta.data</span><span class="op">[</span>, <span class="va">cols</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="match-seurat-tcrs-to-vdjdb">Match Seurat TCRs to VDJdb<a class="anchor" aria-label="anchor" href="#match-seurat-tcrs-to-vdjdb"></a>
</h2>
<p>This section shows how to take the TRA/TRB sequences written into
Seurat metadata and match them against VDJdb, producing a compact table
of each cell’s top hit per chain.</p>
<p><strong>Performance features:</strong> - Parallel processing using
Rayon (Rust) for fast matching across multiple CPU cores - Progress bar
for large datasets (&gt;5000 queries) - Configurable fuzzy matching with
edit distance tolerance</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span></span>
<span><span class="co"># 1) Load a VDJdb (use fat database for more complete annotations)</span></span>
<span><span class="va">db_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vdjdb_packaged_path.html">vdjdb_packaged_path</a></span><span class="op">(</span>use_fat_db <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vdjdb_open_file.html">vdjdb_open_file</a></span><span class="op">(</span><span class="va">db_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Helper to build queries from metadata and get top-1 hit per query</span></span>
<span><span class="co"># For TRA: emits one query per alpha (TRA1 and TRA2 when present)</span></span>
<span><span class="va">get_top_hits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>, <span class="va">db</span>, <span class="va">chain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRB"</span>, <span class="st">"TRA"</span><span class="op">)</span>, <span class="va">scope</span> <span class="op">=</span> <span class="st">"0,0,0,0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">chain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">chain</span><span class="op">)</span></span>
<span>  <span class="va">ch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">chain</span><span class="op">)</span></span>
<span>  <span class="va">md</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">meta.data</span></span>
<span>  <span class="va">queries</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">chain</span> <span class="op">==</span> <span class="st">"TRB"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"vdj."</span>, <span class="va">ch</span>, <span class="st">".cdr3_aa"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"vdj."</span>, <span class="va">ch</span>, <span class="st">".v_gene"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"vdj."</span>, <span class="va">ch</span>, <span class="st">".j_gene"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">cols</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">cdr3_col</span> <span class="op">&lt;-</span> <span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">v_col</span> <span class="op">&lt;-</span> <span class="va">cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>; <span class="va">j_col</span> <span class="op">&lt;-</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cdr3_col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cdr3_col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">keep</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">queries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      cell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span>,</span>
<span>      cdr3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cdr3_col</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      v    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">v_col</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      j    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">j_col</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      alpha_rank <span class="op">=</span> <span class="cn">NA_integer_</span>,</span>
<span>      stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># TRA: build from tra1 and tra2 if present</span></span>
<span>    <span class="va">cols1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vdj.tra1.cdr3_aa"</span>, <span class="st">"vdj.tra1.v_gene"</span>, <span class="st">"vdj.tra1.j_gene"</span><span class="op">)</span></span>
<span>    <span class="va">cols2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vdj.tra2.cdr3_aa"</span>, <span class="st">"vdj.tra2.v_gene"</span>, <span class="st">"vdj.tra2.j_gene"</span><span class="op">)</span></span>
<span>    <span class="va">have1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">cols1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">have2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">cols2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">qlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">have1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">keep1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">keep1</span><span class="op">)</span><span class="op">)</span> <span class="va">qlist</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">qlist</span><span class="op">)</span><span class="op">+</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        cell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">[</span><span class="va">keep1</span><span class="op">]</span>,</span>
<span>        cdr3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        v    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        j    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols1</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        alpha_rank <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>        stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">have2</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">keep2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">keep2</span><span class="op">)</span><span class="op">)</span> <span class="va">qlist</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">qlist</span><span class="op">)</span><span class="op">+</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        cell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">[</span><span class="va">keep2</span><span class="op">]</span>,</span>
<span>        cdr3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        v    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        j    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">md</span><span class="op">[[</span><span class="va">cols2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">keep2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        alpha_rank <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>        stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">qlist</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">queries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">qlist</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Filter DB to species/gene</span></span>
<span>  <span class="va">db_chain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_db.html">filter_db</a></span><span class="op">(</span><span class="va">db</span>, species <span class="op">=</span> <span class="st">"HomoSapiens"</span>, gene <span class="op">=</span> <span class="va">chain</span>, min_vdjdb_score <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Match and get top hit per query (uses parallel processing and shows progress)</span></span>
<span>  <span class="va">hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_tcr_many_df.html">match_tcr_many_df</a></span><span class="op">(</span><span class="va">db_chain</span>, <span class="va">queries</span><span class="op">$</span><span class="va">cdr3</span>, <span class="va">queries</span><span class="op">$</span><span class="va">v</span>, <span class="va">queries</span><span class="op">$</span><span class="va">j</span>,</span>
<span>                            scope <span class="op">=</span> <span class="va">scope</span>, top_n <span class="op">=</span> <span class="fl">1L</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Attach cell metadata back to hits</span></span>
<span>  <span class="va">qi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">hits</span><span class="op">$</span><span class="va">query_index</span><span class="op">)</span></span>
<span>  <span class="va">hits</span><span class="op">$</span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="va">queries</span><span class="op">$</span><span class="va">cell</span><span class="op">[</span><span class="va">qi</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"alpha_rank"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">queries</span><span class="op">)</span><span class="op">)</span> <span class="va">hits</span><span class="op">$</span><span class="va">alpha_rank</span> <span class="op">&lt;-</span> <span class="va">queries</span><span class="op">$</span><span class="va">alpha_rank</span><span class="op">[</span><span class="va">qi</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Rename columns to more user-friendly names</span></span>
<span>  <span class="co"># match_tcr_many_df returns: query_index, query_cdr3, query_v, query_j,</span></span>
<span>  <span class="co">#                            cdr3_db, v_db, j_db, species, gene,</span></span>
<span>  <span class="co">#                            antigen_epitope, antigen_gene, antigen_species,</span></span>
<span>  <span class="co">#                            mhc_class, reference_id, vdjdb_score,</span></span>
<span>  <span class="co">#                            score, cdr3_score, v_score, j_score, edit_distance</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"cdr3_db"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span> <span class="op">==</span> <span class="st">"cdr3_db"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"epitope_cdr3"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"v_db"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span> <span class="op">==</span> <span class="st">"v_db"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"epitope_v"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"j_db"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span> <span class="op">==</span> <span class="st">"j_db"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"epitope_j"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"species"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"epitope_species"</span></span>
<span></span>
<span>  <span class="co"># Select and order columns</span></span>
<span>  <span class="va">keep_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell"</span>, <span class="st">"alpha_rank"</span>, <span class="st">"query_cdr3"</span>, <span class="st">"query_v"</span>, <span class="st">"query_j"</span>,</span>
<span>      <span class="st">"epitope_cdr3"</span>, <span class="st">"epitope_v"</span>, <span class="st">"epitope_j"</span>, <span class="st">"epitope_species"</span>,</span>
<span>      <span class="st">"gene"</span>, <span class="st">"antigen_epitope"</span>, <span class="st">"antigen_gene"</span>, <span class="st">"antigen_species"</span>,</span>
<span>      <span class="st">"mhc_class"</span>, <span class="st">"reference_id"</span>, <span class="st">"vdjdb_score"</span>,</span>
<span>      <span class="st">"score"</span>, <span class="st">"cdr3_score"</span>, <span class="st">"v_score"</span>, <span class="st">"j_score"</span>, <span class="st">"edit_distance"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hits</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">hits</span><span class="op">[</span>, <span class="va">keep_cols</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Match TRB and TRA chains with fuzzy matching (allows up to 3 mismatches)</span></span>
<span><span class="va">top_trb</span> <span class="op">&lt;-</span> <span class="fu">get_top_hits</span><span class="op">(</span><span class="va">obj</span>, <span class="va">db</span>, chain <span class="op">=</span> <span class="st">"TRB"</span>, scope <span class="op">=</span> <span class="st">"0,0,0,0"</span><span class="op">)</span></span>
<span><span class="va">top_tra</span> <span class="op">&lt;-</span> <span class="fu">get_top_hits</span><span class="op">(</span><span class="va">obj</span>, <span class="va">db</span>, chain <span class="op">=</span> <span class="st">"TRA"</span>, scope <span class="op">=</span> <span class="st">"0,0,0,0"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.4.3 (2025-02-28)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS Sequoia 15.4.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: America/Los_Angeles</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] magrittr_2.0.3       vdjmatchR_0.0.0.9000 Seurat_5.3.0        </span></span>
<span><span class="co">#&gt; [4] SeuratObject_5.1.0   sp_2.2-0            </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] RColorBrewer_1.1-3     jsonlite_2.0.0         spatstat.utils_3.1-4  </span></span>
<span><span class="co">#&gt;   [4] farver_2.1.2           rmarkdown_2.29         fs_1.6.6              </span></span>
<span><span class="co">#&gt;   [7] ragg_1.4.0             vctrs_0.6.5            ROCR_1.0-11           </span></span>
<span><span class="co">#&gt;  [10] memoise_2.0.1          spatstat.explore_3.4-3 htmltools_0.5.8.1     </span></span>
<span><span class="co">#&gt;  [13] usethis_3.1.0          curl_6.4.0             sass_0.4.10           </span></span>
<span><span class="co">#&gt;  [16] sctransform_0.4.2      parallelly_1.45.0      KernSmooth_2.23-26    </span></span>
<span><span class="co">#&gt;  [19] bslib_0.9.0            htmlwidgets_1.6.4      desc_1.4.3            </span></span>
<span><span class="co">#&gt;  [22] ica_1.0-3              plyr_1.8.9             plotly_4.11.0         </span></span>
<span><span class="co">#&gt;  [25] zoo_1.8-14             cachem_1.1.0           igraph_2.1.4          </span></span>
<span><span class="co">#&gt;  [28] mime_0.13              lifecycle_1.0.4        pkgconfig_2.0.3       </span></span>
<span><span class="co">#&gt;  [31] Matrix_1.7-3           R6_2.6.1               fastmap_1.2.0         </span></span>
<span><span class="co">#&gt;  [34] fitdistrplus_1.2-2     future_1.58.0          shiny_1.10.0          </span></span>
<span><span class="co">#&gt;  [37] digest_0.6.37          colorspace_2.1-1       patchwork_1.3.1       </span></span>
<span><span class="co">#&gt;  [40] ps_1.9.0               tensor_1.5.1           RSpectra_0.16-2       </span></span>
<span><span class="co">#&gt;  [43] irlba_2.3.5.1          pkgload_1.4.0          textshaping_1.0.0     </span></span>
<span><span class="co">#&gt;  [46] progressr_0.15.1       spatstat.sparse_3.1-0  httr_1.4.7            </span></span>
<span><span class="co">#&gt;  [49] polyclip_1.10-7        abind_1.4-8            compiler_4.4.3        </span></span>
<span><span class="co">#&gt;  [52] remotes_2.5.0          fastDummies_1.7.5      pkgbuild_1.4.7        </span></span>
<span><span class="co">#&gt;  [55] MASS_7.3-65            sessioninfo_1.2.3      tools_4.4.3           </span></span>
<span><span class="co">#&gt;  [58] lmtest_0.9-40          httpuv_1.6.16          future.apply_1.20.0   </span></span>
<span><span class="co">#&gt;  [61] goftest_1.2-3          glue_1.8.0             callr_3.7.6           </span></span>
<span><span class="co">#&gt;  [64] nlme_3.1-168           promises_1.3.3         grid_4.4.3            </span></span>
<span><span class="co">#&gt;  [67] Rtsne_0.17             cluster_2.1.8.1        reshape2_1.4.4        </span></span>
<span><span class="co">#&gt;  [70] generics_0.1.4         gtable_0.3.6           spatstat.data_3.1-6   </span></span>
<span><span class="co">#&gt;  [73] tidyr_1.3.1            data.table_1.17.6      spatstat.geom_3.4-1   </span></span>
<span><span class="co">#&gt;  [76] RcppAnnoy_0.0.22       ggrepel_0.9.6          RANN_2.6.2            </span></span>
<span><span class="co">#&gt;  [79] pillar_1.10.2          stringr_1.5.1          spam_2.11-1           </span></span>
<span><span class="co">#&gt;  [82] RcppHNSW_0.6.0         later_1.4.2            splines_4.4.3         </span></span>
<span><span class="co">#&gt;  [85] dplyr_1.1.4            lattice_0.22-7         deldir_2.0-4          </span></span>
<span><span class="co">#&gt;  [88] survival_3.8-3         tidyselect_1.2.1       miniUI_0.1.2          </span></span>
<span><span class="co">#&gt;  [91] pbapply_1.7-2          knitr_1.50             gridExtra_2.3         </span></span>
<span><span class="co">#&gt;  [94] scattermore_1.2        xfun_0.52              devtools_2.4.5        </span></span>
<span><span class="co">#&gt;  [97] matrixStats_1.5.0      stringi_1.8.7          lazyeval_0.2.2        </span></span>
<span><span class="co">#&gt; [100] yaml_2.3.10            evaluate_1.0.4         codetools_0.2-20      </span></span>
<span><span class="co">#&gt; [103] tibble_3.3.0           cli_3.6.5              uwot_0.2.3            </span></span>
<span><span class="co">#&gt; [106] xtable_1.8-4           reticulate_1.42.0      systemfonts_1.2.2     </span></span>
<span><span class="co">#&gt; [109] processx_3.8.6         jquerylib_0.1.4        dichromat_2.0-0.1     </span></span>
<span><span class="co">#&gt; [112] Rcpp_1.0.14            spatstat.random_3.4-1  globals_0.18.0        </span></span>
<span><span class="co">#&gt; [115] png_0.1-8              spatstat.univar_3.1-3  parallel_4.4.3        </span></span>
<span><span class="co">#&gt; [118] ellipsis_0.3.2         pkgdown_2.1.1          ggplot2_3.5.2         </span></span>
<span><span class="co">#&gt; [121] dotCall64_1.2          profvis_0.4.0          urlchecker_1.0.1      </span></span>
<span><span class="co">#&gt; [124] listenv_0.9.1          viridisLite_0.4.2      scales_1.4.0          </span></span>
<span><span class="co">#&gt; [127] ggridges_0.5.6         purrr_1.0.4            rlang_1.1.6           </span></span>
<span><span class="co">#&gt; [130] cowplot_1.1.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by vdjmatch Authors.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
