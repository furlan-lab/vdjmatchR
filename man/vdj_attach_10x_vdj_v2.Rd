% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/seurat_vdj.R
\name{vdj_attach_10x_vdj_v2}
\alias{vdj_attach_10x_vdj_v2}
\title{Attach 10x 5' VDJ v2 data to a Seurat v5 object}
\usage{
vdj_attach_10x_vdj_v2(
  seurat,
  vdj_dir,
  sample_id = NULL,
  barcode_prefix = NULL,
  cell_regex = NULL,
  cell_map = NULL,
  tool_key = "vdj",
  add_meta = TRUE,
  include_cdr12 = FALSE,
  include_nt_subseq = FALSE,
  expected_t_fraction = 0.5
)
}
\arguments{
\item{seurat}{A Seurat v5 object.}

\item{vdj_dir}{Path to the 10x VDJ directory containing \code{filtered_contig_annotations.csv} and \code{clonotypes.csv}.}

\item{sample_id}{Optional sample identifier. If NULL, inferred from \code{vdj_dir} (parent folder name if \code{vdj_dir} ends with \code{vdj_t}).}

\item{barcode_prefix}{Optional prefix to help exact matching (tries \code{prefix + barcode} and \code{prefix + "_" + barcode}).}

\item{cell_regex}{Optional regex with one capture group to extract barcodes from cell names.}

\item{cell_map}{Optional explicit mapping (named character vector barcode->cell or a data.frame with \code{barcode} and \code{cell}). Overrides other strategies.}

\item{tool_key}{Name under \code{obj@tools} where results are stored (default \code{"vdj"}).}

\item{add_meta}{If TRUE, write \code{vdj.clone_id_10x} and \code{vdj.clone_size_10x} to metadata for mapped cells.}

\item{include_cdr12}{If TRUE, attempt to import CDR1 and CDR2 amino-acid sequences when columns \code{cdr1} and \code{cdr2} exist in the contigs file.}

\item{include_nt_subseq}{If TRUE, and when corresponding columns exist (e.g., \code{cdr3_nt}, \code{cdr1_nt}, \code{cdr2_nt}), also write nucleotide sequences for these subsequences.}

\item{expected_t_fraction}{Expected fraction of T cells among queried Seurat cells. Used to gate warnings
about unmatched cells. A warning is emitted only if \code{(unmatched / queried) > (1 - expected_t_fraction)}.
Default: \code{0.5}.}
}
\value{
Updated Seurat object (invisible).
}
\description{
Reads Cell Ranger VDJ v2 outputs (filtered_contig_annotations.csv and clonotypes.csv),
flexibly maps 10x barcodes to Seurat cell names, and stores heavy tables under
\code{obj@tools[[tool_key]]}. Optionally writes minimal metadata (10x clonotype id/size).
}
\details{
Assumptions: human, TRA/TRB only. No code path depends on Seurat being attached; the
function only uses base slots and data.frame operations to keep Seurat as an optional dependency.

Mapping strategies (applied in priority order, filling only unmatched barcodes):
\itemize{
\item \code{cell_map}: explicit mapping (named character vector barcode->cell or data.frame with
columns \code{barcode} and \code{cell}).
\item \code{cell_regex}: regex with a single capture group applied to Seurat cell names to extract
the barcode; unique matches are used.
\item Exact match: Seurat cell name exactly equals the 10x barcode (e.g., "AAAC...-1").
\item \code{barcode_prefix}: attempt exact match using \code{paste0(prefix, barcode)} and \code{paste0(prefix, "_", barcode)}.
\item Suffix match: Seurat cell name ends with the 10x barcode (common when names are prefixed).
}

Multi-sample: All stored tables include \code{sample_id}. Mapping does not restrict to
any metadata field; it operates purely on cell barcodes (with optional prefixes/regex).
}
